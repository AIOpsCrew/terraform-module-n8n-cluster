<mxfile host="app.diagrams.net">
  <diagram name="n8n-architecture" id="architecture">
    <mxGraphModel dx="1600" dy="1000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="title" value="n8n on AWS Fargate - High Availability Architecture" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontSize=20;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="800" height="40" as="geometry"/>
        </mxCell>

        <!-- Internet/Users -->
        <mxCell id="internet" value="Internet Users" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=14;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="600" y="80" width="200" height="80" as="geometry"/>
        </mxCell>

        <!-- AWS Cloud -->
        <mxCell id="aws" value="AWS Cloud (us-west-2)" style="points=[[0,0],[0.25,0],[0.5,0],[0.75,0],[1,0],[1,0.25],[1,0.5],[1,0.75],[1,1],[0.75,1],[0.5,1],[0.25,1],[0,1],[0,0.75],[0,0.5],[0,0.25]];outlineConnect=0;gradientColor=none;html=1;whiteSpace=wrap;fontSize=13;fontStyle=1;container=1;pointerEvents=0;collapsible=0;recursiveResize=0;shape=mxgraph.aws4.group;grIcon=mxgraph.aws4.group_aws_cloud;strokeColor=#232F3E;fillColor=none;verticalAlign=top;align=left;spacingLeft=30;dashed=0;" vertex="1" parent="1">
          <mxGeometry x="100" y="200" width="1200" height="640" as="geometry"/>
        </mxCell>

        <!-- Internet Gateway -->
        <mxCell id="igw" value="Internet Gateway" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#8C4FFF;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=12;fontStyle=1;aspect=fixed;shape=mxgraph.aws4.internet_gateway;" vertex="1" parent="aws">
          <mxGeometry x="540" y="30" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- VPC -->
        <mxCell id="vpc" value="VPC - 10.0.0.0/16" style="points=[[0,0],[0.25,0],[0.5,0],[0.75,0],[1,0],[1,0.25],[1,0.5],[1,0.75],[1,1],[0.75,1],[0.5,1],[0.25,1],[0,1],[0,0.75],[0,0.5],[0,0.25]];outlineConnect=0;gradientColor=none;html=1;whiteSpace=wrap;fontSize=12;fontStyle=1;container=1;pointerEvents=0;collapsible=0;recursiveResize=0;shape=mxgraph.aws4.group;grIcon=mxgraph.aws4.group_vpc;strokeColor=#248814;fillColor=none;verticalAlign=top;align=left;spacingLeft=30;dashed=0;" vertex="1" parent="aws">
          <mxGeometry x="100" y="140" width="1000" height="470" as="geometry"/>
        </mxCell>

        <!-- ALB (spans both AZs) -->
        <mxCell id="alb" value="Application Load Balancer" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#8C4FFF;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=11;fontStyle=1;aspect=fixed;shape=mxgraph.aws4.application_load_balancer;" vertex="1" parent="vpc">
          <mxGeometry x="460" y="50" width="80" height="80" as="geometry"/>
        </mxCell>

        <!-- AZ 1 -->
        <mxCell id="az1" value="Availability Zone A (us-west-2a)" style="fillColor=none;strokeColor=#147EBA;dashed=1;verticalAlign=top;fontStyle=2;fontSize=11;whiteSpace=wrap;" vertex="1" parent="vpc">
          <mxGeometry x="40" y="170" width="420" height="280" as="geometry"/>
        </mxCell>

        <!-- AZ 2 -->
        <mxCell id="az2" value="Availability Zone B (us-west-2b)" style="fillColor=none;strokeColor=#147EBA;dashed=1;verticalAlign=top;fontStyle=2;fontSize=11;whiteSpace=wrap;" vertex="1" parent="vpc">
          <mxGeometry x="540" y="170" width="420" height="280" as="geometry"/>
        </mxCell>

        <!-- AZ1: Public Subnet -->
        <mxCell id="pub1" value="Public Subnet" style="fillColor=#E9F3E6;strokeColor=#248814;verticalAlign=top;fontSize=10;" vertex="1" parent="vpc">
          <mxGeometry x="70" y="200" width="140" height="80" as="geometry"/>
        </mxCell>

        <mxCell id="nat1" value="NAT GW" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#8C4FFF;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=9;aspect=fixed;shape=mxgraph.aws4.nat_gateway;" vertex="1" parent="vpc">
          <mxGeometry x="115" y="225" width="50" height="50" as="geometry"/>
        </mxCell>

        <!-- AZ1: Private Subnet -->
        <mxCell id="priv1" value="Private Subnet" style="fillColor=#E6F2F8;strokeColor=#147EBA;verticalAlign=top;fontSize=10;" vertex="1" parent="vpc">
          <mxGeometry x="70" y="300" width="140" height="70" as="geometry"/>
        </mxCell>

        <mxCell id="ecs1" value="ECS Task" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#ED7100;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=9;aspect=fixed;shape=mxgraph.aws4.ecs_task;" vertex="1" parent="vpc">
          <mxGeometry x="115" y="318" width="50" height="50" as="geometry"/>
        </mxCell>

        <!-- AZ1: DB Subnet -->
        <mxCell id="db1-sub" value="DB Subnet" style="fillColor=#E6F2F8;strokeColor=#147EBA;verticalAlign=top;fontSize=10;" vertex="1" parent="vpc">
          <mxGeometry x="250" y="300" width="140" height="70" as="geometry"/>
        </mxCell>

        <mxCell id="db1" value="Aurora" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#C925D1;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=9;aspect=fixed;shape=mxgraph.aws4.aurora_instance;" vertex="1" parent="vpc">
          <mxGeometry x="295" y="318" width="50" height="50" as="geometry"/>
        </mxCell>

        <!-- AZ2: Public Subnet -->
        <mxCell id="pub2" value="Public Subnet" style="fillColor=#E9F3E6;strokeColor=#248814;verticalAlign=top;fontSize=10;" vertex="1" parent="vpc">
          <mxGeometry x="570" y="200" width="140" height="80" as="geometry"/>
        </mxCell>

        <mxCell id="nat2" value="NAT GW" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#8C4FFF;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=9;aspect=fixed;shape=mxgraph.aws4.nat_gateway;" vertex="1" parent="vpc">
          <mxGeometry x="615" y="225" width="50" height="50" as="geometry"/>
        </mxCell>

        <!-- AZ2: Private Subnet -->
        <mxCell id="priv2" value="Private Subnet" style="fillColor=#E6F2F8;strokeColor=#147EBA;verticalAlign=top;fontSize=10;" vertex="1" parent="vpc">
          <mxGeometry x="570" y="300" width="140" height="70" as="geometry"/>
        </mxCell>

        <mxCell id="ecs2" value="ECS Task" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#ED7100;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=9;aspect=fixed;shape=mxgraph.aws4.ecs_task;" vertex="1" parent="vpc">
          <mxGeometry x="615" y="318" width="50" height="50" as="geometry"/>
        </mxCell>

        <!-- AZ2: DB Subnet -->
        <mxCell id="db2-sub" value="DB Subnet" style="fillColor=#E6F2F8;strokeColor=#147EBA;verticalAlign=top;fontSize=10;" vertex="1" parent="vpc">
          <mxGeometry x="750" y="300" width="140" height="70" as="geometry"/>
        </mxCell>

        <mxCell id="db2" value="Aurora" style="sketch=0;outlineConnect=0;fontColor=#232F3E;fillColor=#C925D1;strokeColor=none;dashed=0;verticalLabelPosition=bottom;verticalAlign=top;align=center;fontSize=9;aspect=fixed;shape=mxgraph.aws4.aurora_instance;" vertex="1" parent="vpc">
          <mxGeometry x="795" y="318" width="50" height="50" as="geometry"/>
        </mxCell>

        <!-- Traffic Flows -->

        <!-- Internet to IGW -->
        <mxCell id="flow1" value="HTTPS" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeWidth=3;strokeColor=#232F3E;fontSize=11;fontStyle=1;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="internet" target="igw">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- IGW to ALB -->
        <mxCell id="flow2" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeWidth=3;strokeColor=#232F3E;exitX=0.5;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="igw" target="alb">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ALB to ECS1 -->
        <mxCell id="flow3" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeWidth=2;strokeColor=#ED7100;exitX=0.25;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="alb" target="ecs1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ALB to ECS2 -->
        <mxCell id="flow4" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeWidth=2;strokeColor=#ED7100;exitX=0.75;exitY=1;entryX=0.5;entryY=0;" edge="1" parent="1" source="alb" target="ecs2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ECS1 to DB1 -->
        <mxCell id="flow5" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeWidth=2;strokeColor=#C925D1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="ecs1" target="db1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ECS2 to DB2 -->
        <mxCell id="flow6" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeWidth=2;strokeColor=#C925D1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;" edge="1" parent="1" source="ecs2" target="db2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- NAT Gateways to IGW (outbound) -->
        <mxCell id="nat1-out" value="Outbound" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeWidth=1;strokeColor=#147EBA;dashed=1;fontSize=9;exitX=0.5;exitY=0;entryX=0;entryY=1;" edge="1" parent="1" source="nat1" target="igw">
          <mxGeometry x="-0.5" relative="1" as="geometry">
            <mxPoint as="offset"/>
          </mxGeometry>
        </mxCell>

        <mxCell id="nat2-out" value="Outbound" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeWidth=1;strokeColor=#147EBA;dashed=1;fontSize=9;exitX=0.5;exitY=0;entryX=1;entryY=1;" edge="1" parent="1" source="nat2" target="igw">
          <mxGeometry x="-0.5" relative="1" as="geometry">
            <mxPoint as="offset"/>
          </mxGeometry>
        </mxCell>

        <!-- ECS to NAT (outbound internet access) -->
        <mxCell id="ecs1-nat-out" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeWidth=1;strokeColor=#147EBA;dashed=1;exitX=0.5;exitY=0;entryX=0.5;entryY=1;" edge="1" parent="1" source="ecs1" target="nat1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="ecs2-nat-out" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;strokeWidth=1;strokeColor=#147EBA;dashed=1;exitX=0.5;exitY=0;entryX=0.5;entryY=1;" edge="1" parent="1" source="ecs2" target="nat2">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="150" y="870" width="500" height="20" as="geometry"/>
        </mxCell>

        <mxCell id="legend" value="━━━ User Traffic (HTTPS)     ━━━ Database Connection     - - - Outbound Internet (via NAT)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="160" y="872" width="480" height="16" as="geometry"/>
        </mxCell>

        <!-- Key Features -->
        <mxCell id="features" value="Multi-AZ HA  •  Auto-Scaling Database (Aurora Serverless v2)  •  SSL/TLS Encryption  •  Private Subnets" style="text;html=1;align=center;fontSize=10;fontColor=#666666;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="300" y="850" width="800" height="20" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
